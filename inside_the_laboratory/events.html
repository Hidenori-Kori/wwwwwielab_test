<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ™ãƒ³ãƒˆãƒ»æ—…è¡Œ | é­ç ”ç©¶å®¤</title>
    <link rel="stylesheet" href="../Base/style.css"> 
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
</head>
<body>

    <div id="header-placeholder"></div>

    <div class="swiper hero-slider">
        <div class="swiper-wrapper" id="slider-wrapper">
            </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <section class="event-list">
        <div class="container">
            <h2 class="section-title">Events & Trips</h2>
            <div id="event-list-wrapper">
                </div>
        </div>
    </section>
    
    <div id="footer-placeholder"></div>

    <script src="../include.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            loadComponent('header-placeholder', '../header.html');
            loadComponent('footer-placeholder', '../footer.html');
            
            // CSVãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã¨ç”Ÿæˆ
            loadEventsData();
        });

        async function loadEventsData() {
            try {
                const response = await fetch('../csv/events_data.csv');
                if (!response.ok) throw new Error("CSV file not found");
                const text = await response.text();

                // CSVãƒ‘ãƒ¼ã‚¹ (1è¡Œç›®ã¯ãƒ˜ãƒƒãƒ€ãƒ¼ãªã®ã§å‰Šé™¤)
                const rows = text.trim().split('\n').slice(1);

                const sliderWrapper = document.getElementById('slider-wrapper');
                const listWrapper = document.getElementById('event-list-wrapper');

                rows.forEach(row => {
                    // ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š (ãƒ‡ãƒ¼ã‚¿å†…ã«ã‚«ãƒ³ãƒãŒã‚ã‚‹å ´åˆã¯æ³¨æ„ãŒå¿…è¦ã§ã™ãŒç°¡æ˜“å®Ÿè£…)
                    const cols = row.split(',');
                    if (cols.length < 5) return;

                    const date = cols[0];
                    const title = cols[1];
                    const location = cols[2];
                    const members = cols[3];
                    const image = cols[4];
                    const link = cols[5] ? cols[5].trim() : "";

                    // 1. ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¸ã®è¿½åŠ 
                    const slide = document.createElement('div');
                    slide.className = 'swiper-slide';
                    slide.style.backgroundImage = `url('${image}')`;
                    slide.innerHTML = `
                        <div class="slide-overlay"></div>
                        <div class="slide-content">
                            <h2>${title}</h2>
                            <p>${date} / ${location}</p>
                        </div>
                    `;
                    sliderWrapper.appendChild(slide);


                    // 2. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆã¸ã®è¿½åŠ 
                    // ãƒªãƒ³ã‚¯ãŒã‚ã‚‹å ´åˆã¯ <a> ã‚¿ã‚°ã€ãªã‘ã‚Œã° <div> ã‚¿ã‚°ã«ã™ã‚‹
                    const cardTag = link ? 'a' : 'div';
                    const hrefAttr = link ? `href="${link}"` : '';
                    
                    const card = document.createElement(cardTag);
                    card.className = 'event-card';
                    if(link) card.setAttribute('href', link);
                    
                    card.innerHTML = `
                        <div class="event-img" style="background-image: url('${image}');"></div>
                        <div class="event-info">
                            <div class="event-date">${date}</div>
                            <h3 class="event-title">${title}</h3>
                            <div class="event-meta">ğŸ“ å ´æ‰€: ${location}</div>
                            <div class="event-meta">ğŸ‘¥ å‚åŠ : ${members}</div>
                        </div>
                    `;
                    listWrapper.appendChild(card);
                });

                // Swiperã®åˆæœŸåŒ–
                initSwiper();

            } catch (error) {
                console.error("Events Error:", error);
            }
        }

        function initSwiper() {
            new Swiper(".hero-slider", {
                loop: true,
                speed: 1000, // ã‚†ã£ãã‚Šåˆ‡ã‚Šæ›¿ã‚ã‚‹
                autoplay: {
                    delay: 4000,
                    disableOnInteraction: false,
                },
                effect: 'fade', // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ãƒ»ã‚¢ã‚¦ãƒˆã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
            });
        }
    </script>
</body>
</html>